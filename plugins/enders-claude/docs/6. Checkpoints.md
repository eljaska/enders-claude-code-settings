# 6. Checkpoints - Session-Level Version Control

## Overview

Checkpoints are automatic snapshots of your code state captured before each Claude Code edit. They enable quick undo/redo without using Git - perfect for experimentation and recovery from mistakes.

**Think of them as**: Ctrl+Z for your Claude Code session - instant time travel for code changes.

**Key characteristics**:
- Automatic snapshot creation
- Rewind conversation and/or code
- Session-level (not cross-session)
- 30-day retention
- Instant recovery
- Accessible via `/rewind` or **Esc+Esc**

## Key Concepts

### Checkpoints vs. Git

| Checkpoint | Git |
|------------|-----|
| Session-level | Repository-level |
| Automatic | Manual |
| Instant rewind | Requires commit/reset |
| Edit/Write tools only | All file changes |
| 30-day retention | Permanent |
| No branching | Full branching |

**Use checkpoints for**: Short-term undo, experimentation, quick recovery
**Use Git for**: Long-term history, collaboration, branching

### What Gets Tracked

**Tracked**:
- ✅ Changes from Edit tool
- ✅ Changes from Write tool
- ✅ Conversation history
- ✅ User prompts

**Not Tracked**:
- ❌ Changes from Bash commands (`rm`, `mv`, `cp`)
- ❌ External edits (IDE, other tools)
- ❌ Changes in other sessions
- ❌ Git operations

### Rewind Options

When you rewind, you can choose:

1. **Conversation only**: Go back to a previous message, keep code changes
2. **Code only**: Revert file changes, keep conversation
3. **Both**: Restore both conversation and code to prior state

## How It Works

### Checkpoint Creation

```
User submits prompt
  ↓
Checkpoint created automatically
  ↓
Claude responds and may edit files
  ↓
Changes tracked
  ↓
Next user prompt
  ↓
New checkpoint created
  ↓
Previous checkpoint saved
```

### Rewind Process

```
User: Esc + Esc (or /rewind)
  ↓
Show checkpoint menu
  ↓
User selects checkpoint
  ↓
User chooses rewind mode:
  - Conversation only
  - Code only
  - Both
  ↓
Restore selected state
  ↓
Continue from that point
```

### Storage

Checkpoints are stored locally:
- Location: `~/.claude/checkpoints/`
- Automatic cleanup after 30 days
- Per-session storage
- Binary efficient format

## Configuration

### No Configuration Required

Checkpoints work automatically with no setup needed.

### Commands

| Command | Description |
|---------|-------------|
| **Esc + Esc** | Open rewind menu (GUI) |
| `/rewind` | Text-based rewind command |

## Usage Patterns

### Basic Usage

#### Example 1: Undo Bad Changes

**Scenario**: Claude makes unwanted changes

```
User: Refactor the authentication system
Claude: [Makes extensive changes]
User: [Reviews changes] These aren't what I wanted
User: [Esc + Esc]
User: [Select checkpoint before refactor]
User: [Choose "Code only"]
User: Let's try a different approach...
```

**Result**: Code reverted, conversation preserved, can try again

#### Example 2: Explore Alternatives

**Scenario**: Try different implementations

```
User: Implement caching for the API
Claude: [Implements Redis caching]
User: [Esc + Esc, rewind code only]
User: Now try in-memory caching instead
Claude: [Implements in-memory caching]
User: [Compare approaches]
```

**Result**: Can try multiple approaches from same starting point

#### Example 3: Recover from Mistakes

**Scenario**: Accidentally deleted important code

```
User: Remove the old login code
Claude: [Deletes more than intended]
User: Wait, that deleted too much!
User: /rewind
User: [Select checkpoint before deletion]
User: [Choose "Both"]
```

**Result**: Code and conversation restored, nothing lost

### Advanced Usage

#### Example 4: Iterative Refinement

**Scenario**: Refine implementation through multiple attempts

```
Checkpoint 1: Initial implementation
  ↓
Try approach A
  ↓
Checkpoint 2: After approach A
  ↓
Not satisfied, rewind to Checkpoint 1
  ↓
Try approach B
  ↓
Checkpoint 3: After approach B
  ↓
Keep approach B
```

#### Example 5: Safe Experimentation

**Scenario**: Test risky changes safely

```
User: Let's optimize this critical database query
Claude: [Makes changes]
User: [Tests changes]
User: [Performance worse]
User: [Esc + Esc, rewind to before changes]
User: Let's try indexing instead
```

**Result**: Can experiment without fear of breaking things

#### Example 6: Conversation Reset

**Scenario**: Remove confusing conversation path

```
User: [Long discussion leading Claude astray]
User: [Esc + Esc]
User: [Rewind conversation only to before confusion]
User: [Restart discussion with clearer direction]
```

**Result**: Keep code changes, fix conversation context

## Examples

### Complete Rewind Workflows

#### Workflow 1: Feature Development with Rollback

```
1. User: "Add user profile page"
   Checkpoint A created
   Claude: [Implements profile page]

2. User: "Add profile photo upload"
   Checkpoint B created
   Claude: [Adds upload functionality]

3. User: "Add photo cropping"
   Checkpoint C created
   Claude: [Adds cropping, introduces bug]

4. User discovers bug in upload
   Esc + Esc
   Select Checkpoint B
   Choose "Code only"

5. User: "Add photo upload with validation"
   Claude: [Implements correctly]
```

#### Workflow 2: Exploring Design Patterns

```
1. User: "Implement authentication"
   Checkpoint A
   Claude: [Implements JWT-based auth]

2. User reviews, wants to compare
   Esc + Esc → Checkpoint A
   Choose "Code only"

3. User: "Implement session-based auth instead"
   Checkpoint B
   Claude: [Implements session-based]

4. User compares both approaches
   Chooses JWT version
   Esc + Esc → Checkpoint between A and B
   Chooses JWT implementation
```

#### Workflow 3: Debugging with Checkpoints

```
1. Working code
   Checkpoint A

2. User: "Optimize the search function"
   Claude: [Makes optimizations]
   Checkpoint B

3. Tests fail
   Esc + Esc → Checkpoint A
   Code restored

4. User: "Optimize search with tests"
   Claude: [Optimizes with TDD approach]
   Tests pass ✓
```

## Best Practices

### When to Use Checkpoints

**Use checkpoints for**:
- ✅ Trying different approaches
- ✅ Recovering from recent mistakes
- ✅ Experimental changes
- ✅ Resetting confusing conversation
- ✅ Comparing implementations
- ✅ Safe refactoring

**Don't use checkpoints for**:
- ❌ Long-term version control (use Git)
- ❌ Undoing bash command changes
- ❌ Sharing with team (use Git)
- ❌ Cross-session history
- ❌ Backup (use Git)

### Checkpoint Strategy

1. **Rewind early**: Don't wait, rewind as soon as something goes wrong

2. **Experiment freely**: Knowing you can rewind makes you bolder

3. **Combine with Git**:
   - Checkpoints for experimentation
   - Git commits when satisfied
   - Git for long-term history

4. **Use "Code only" often**: Keeps conversation context, reverts code

5. **Use "Both" for fresh starts**: Complete reset when needed

### Integration with Git

**Workflow**:
```
Edit code with Claude
  ↓
Use checkpoints to try alternatives
  ↓
Find best approach
  ↓
Commit to Git
  ↓
Continue with confidence (can still checkpoint)
```

**Example**:
```bash
# Experiment with checkpoints
User: Try different caching strategies
[Use checkpoints to compare]

# Once satisfied
git add .
git commit -m "Implement Redis caching"

# Continue with checkpoints available
User: Now optimize the cache key generation
[Still have checkpoints if needed]
```

## Common Patterns

### Pattern 1: Try Multiple Solutions

```
Start point
  ├─ Try solution A
  │  └─ Rewind
  ├─ Try solution B
  │  └─ Rewind
  └─ Try solution C
     └─ Keep this one
```

### Pattern 2: Incremental Refinement

```
Base implementation
  ├─ Add feature X
  ├─ Test, looks good
  ├─ Add feature Y
  ├─ Test, has bug
  └─ Rewind, fix Y differently
```

### Pattern 3: Safe Refactoring

```
Working code (checkpoint)
  ↓
Attempt refactor
  ↓
Tests fail
  ↓
Rewind to working code
  ↓
Try different refactor approach
  ↓
Tests pass ✓
  ↓
Git commit
```

## Gotchas and Troubleshooting

### Common Issues

#### Issue 1: Bash Changes Not Undone

**Symptoms**: Files modified by bash commands not reverted

**Cause**: Checkpoints only track Edit/Write tools

**Workaround**: Use Git to undo bash changes
```bash
git checkout -- filename
```

#### Issue 2: External Edits Not Tracked

**Symptoms**: Changes made in IDE not in checkpoints

**Cause**: Checkpoints only track Claude's edits

**Solution**: Use Git for all changes, or only edit via Claude

#### Issue 3: Cross-Session History Unavailable

**Symptoms**: Can't rewind to yesterday's changes

**Cause**: Checkpoints are session-level only

**Solution**: Use Git history
```bash
git log
git checkout <commit>
```

#### Issue 4: Checkpoint Too Old

**Symptoms**: Checkpoint not available

**Cause**: 30-day cleanup

**Solution**: Important changes should be committed to Git

### Limitations

1. **Session-only**: Can't rewind across sessions
2. **Edit/Write only**: Bash changes not tracked
3. **30-day retention**: Old checkpoints deleted
4. **No branching**: Can't maintain multiple branches
5. **No sharing**: Can't share checkpoints with team
6. **Local only**: Not synced across machines

## API Reference

### Commands

| Command | Description | Shortcut |
|---------|-------------|----------|
| `/rewind` | Text-based rewind | Esc + Esc |

### Rewind Options

| Option | Effect |
|--------|--------|
| **Conversation only** | Rewind conversation, keep code changes |
| **Code only** | Revert code changes, keep conversation |
| **Both** | Restore both conversation and code |

### Checkpoint Lifecycle

| Action | Result |
|--------|--------|
| User prompt | New checkpoint created |
| Claude edit | Change tracked in checkpoint |
| Rewind | Restore to selected checkpoint |
| Session end | Checkpoints saved (30 days) |
| 30 days pass | Checkpoints cleaned up |

## Related Features

### Git
Checkpoints complement Git. Use checkpoints for short-term experimentation, Git for long-term history.

### Hooks
Hooks execute on tool use, checkpoints capture the results. Combine for safe automation.

### Skills
Skills may make many edits - use checkpoints to try different skill approaches.

## Additional Resources

- **Official Documentation**: https://docs.anthropic.com/claude/docs/claude-code-checkpoints
- **Best Practices**: https://docs.anthropic.com/claude/docs/checkpoints-guide

---

**Next**: Learn about [Output Styles](./7.%20Output%20Styles.md) for response customization.
